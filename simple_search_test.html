<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Search Test</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
    <style>
        body {
            padding: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .search-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .flight-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            transition: all 0.3s ease;
        }
        .flight-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-color: #007bff;
        }
        #results {
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="search-container">
        <h1 class="text-center mb-4"><i class="fas fa-plane"></i> Simple Search Test</h1>
        
        <!-- Search Form -->
        <form id="searchForm">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label>From</label>
                        <select class="form-control" id="from" required>
                            <option value="">Select</option>
                            <option value="Kolkata">Kolkata</option>
                            <option value="Bangalore">Bangalore</option>
                            <option value="Delhi">Delhi</option>
                            <option value="Mumbai">Mumbai</option>
                            <option value="Chennai">Chennai</option>
                            <option value="Jaipur">Jaipur</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>To</label>
                        <select class="form-control" id="to" required>
                            <option value="">Select</option>
                            <option value="Kolkata">Kolkata</option>
                            <option value="Bangalore">Bangalore</option>
                            <option value="Delhi">Delhi</option>
                            <option value="Mumbai">Mumbai</option>
                            <option value="Chennai">Chennai</option>
                            <option value="Jaipur">Jaipur</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" class="form-control" id="date" required>
                    </div>
                </div>
            </div>
            <button type="submit" class="btn btn-primary btn-block btn-lg">
                <i class="fas fa-search"></i> <span id="btnText">Search Flights</span>
            </button>
        </form>
        
        <!-- Results Section -->
        <div id="results" style="display:none;">
            <hr class="my-4">
            <h3 id="resultsTitle"></h3>
            <div id="resultsContainer"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        // Set today's date as minimum
        document.getElementById('date').min = new Date().toISOString().split('T')[0];
        document.getElementById('date').value = new Date().toISOString().split('T')[0];
        
        // Form submission
        document.getElementById('searchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('‚úÖ Form submitted!');
            
            const from = document.getElementById('from').value;
            const to = document.getElementById('to').value;
            const date = document.getElementById('date').value;
            
            console.log('Search params:', { from, to, date });
            
            if (!from || !to || !date) {
                alert('Please fill all fields');
                return;
            }
            
            if (from === to) {
                alert('Source and destination cannot be same');
                return;
            }
            
            // Show loading
            const btnText = document.getElementById('btnText');
            const originalText = btnText.innerHTML;
            btnText.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Searching...';
            
            try {
                console.log('üîÑ Fetching from API...');
                
                const response = await fetch('search_flights.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ from, to, date })
                });
                
                console.log('üì° Response status:', response.status);
                
                const text = await response.text();
                console.log('üìÑ Raw response:', text);
                
                let data;
                try {
                    data = JSON.parse(text);
                    console.log('‚úÖ Parsed JSON:', data);
                } catch (parseError) {
                    console.error('‚ùå JSON parse error:', parseError);
                    alert('Server returned invalid response. Check console for details.');
                    btnText.innerHTML = originalText;
                    return;
                }
                
                // Reset button
                btnText.innerHTML = originalText;
                
                // Handle response
                const flights = Array.isArray(data) ? data : (data.flights || []);
                console.log('‚úàÔ∏è Flights found:', flights.length);
                
                // Show results section
                document.getElementById('results').style.display = 'block';
                document.getElementById('resultsTitle').innerHTML = 
                    `<i class="fas fa-plane-departure"></i> Found ${flights.length} flight(s) from ${from} to ${to}`;
                
                const container = document.getElementById('resultsContainer');
                
                if (flights.length === 0) {
                    container.innerHTML = `
                        <div class="alert alert-warning">
                            <h5><i class="fas fa-info-circle"></i> No Flights Found</h5>
                            <p>No flights available for this route.</p>
                            <a href="add_complete_network.php" class="btn btn-primary">Add Flights to Database</a>
                        </div>
                    `;
                } else {
                    let html = '';
                    flights.forEach(flight => {
                        html += `
                            <div class="flight-card">
                                <div class="row align-items-center">
                                    <div class="col-md-3">
                                        <h5><i class="fas fa-plane"></i> ${flight.flight_company}</h5>
                                        <p class="text-muted mb-0">${flight.flight_number}</p>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="mb-0">
                                            <strong>${flight.departing_time || 'N/A'}</strong> ‚Üí 
                                            <strong>${flight.arrival_time || 'N/A'}</strong>
                                        </p>
                                        <small class="text-muted">${flight.source} ‚Üí ${flight.destination}</small>
                                    </div>
                                    <div class="col-md-3">
                                        <h4 class="text-success mb-0">‚Çπ${flight.price_economy}</h4>
                                        <small class="text-muted">${flight.available_seats || 0} seats</small>
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-primary btn-block" onclick="alert('Book flight: ${flight.flight_number}')">
                                            Book
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    container.innerHTML = html;
                }
                
                // Scroll to results
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('Error: ' + error.message + '\n\nMake sure XAMPP Apache is running!');
                btnText.innerHTML = originalText;
            }
        });
    </script>
</body>
</html>


















