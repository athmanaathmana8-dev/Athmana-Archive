<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Flight Search</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 50px 0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        .status-ok {
            color: #28a745;
            font-weight: bold;
        }
        .status-error {
            color: #dc3545;
            font-weight: bold;
        }
        .test-result {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 400px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-card">
            <h2><i class="fas fa-vial"></i> Flight Search API Test</h2>
            <p>This page tests if your flight search is working correctly</p>
            <hr>
            
            <div id="testResults">
                <p><i class="fas fa-spinner fa-spin"></i> Running tests...</p>
            </div>
            
            <button class="btn btn-primary btn-lg btn-block mt-3" onclick="runTests()">
                <i class="fas fa-redo"></i> Run Tests Again
            </button>
            
            <a href="Frontpage.html" class="btn btn-success btn-lg btn-block mt-2">
                <i class="fas fa-home"></i> Go to Home Page
            </a>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        async function runTests() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Running tests...</p>';
            
            let html = '<h4>Test Results:</h4>';
            
            // Test 1: Check if search_flights.php exists
            html += '<div class="test-result">';
            html += '<h5><i class="fas fa-check-circle status-ok"></i> Test 1: API Endpoint Check</h5>';
            html += '<p>Testing if search_flights.php is accessible...</p>';
            
            try {
                // Test with Kochi to Pune (from your screenshot)
                const response = await fetch('search_flights.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        from: 'Kochi',
                        to: 'Pune',
                        date: '2025-12-02'
                    })
                });
                
                html += `<p><strong>Response Status:</strong> ${response.status} ${response.statusText}</p>`;
                
                const text = await response.text();
                console.log('Raw Response:', text);
                
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    html += '<p class="status-error"><i class="fas fa-times-circle"></i> Error: Invalid JSON response</p>';
                    html += '<pre>' + text.substring(0, 500) + '</pre>';
                    html += '</div>';
                    resultsDiv.innerHTML = html;
                    return;
                }
                
                html += '<p class="status-ok"><i class="fas fa-check-circle"></i> Valid JSON response received!</p>';
                
                // Check if we got flights
                const flights = Array.isArray(data) ? data : (data.flights || []);
                html += `<p><strong>Flights Found:</strong> ${flights.length}</p>`;
                
                if (data.error) {
                    html += `<p class="status-error"><i class="fas fa-exclamation-triangle"></i> Error: ${data.error}</p>`;
                } else if (flights.length === 0) {
                    html += '<p class="status-error"><i class="fas fa-info-circle"></i> No flights found for Kochi to Pune</p>';
                    html += '<p>ðŸ’¡ You need to add flights to your database. <a href="add_more_flights.php">Click here to add flights</a></p>';
                } else {
                    html += '<p class="status-ok"><i class="fas fa-plane"></i> Great! Flights are available:</p>';
                    html += '<ul>';
                    flights.forEach(flight => {
                        html += `<li>${flight.flight_company} ${flight.flight_number} - â‚¹${flight.price_economy} (Economy)</li>`;
                    });
                    html += '</ul>';
                }
                
                html += '<details><summary>View Full Response</summary><pre>' + JSON.stringify(data, null, 2) + '</pre></details>';
                html += '</div>';
                
                // Test 2: Check database connection
                html += '<div class="test-result">';
                html += '<h5><i class="fas fa-database"></i> Test 2: Database Status</h5>';
                if (data.error && data.error.includes('Database')) {
                    html += '<p class="status-error"><i class="fas fa-times-circle"></i> Database connection failed!</p>';
                    html += '<p>Make sure your XAMPP MySQL is running.</p>';
                } else {
                    html += '<p class="status-ok"><i class="fas fa-check-circle"></i> Database connection working!</p>';
                }
                html += '</div>';
                
                // Test 3: Frontend Integration
                html += '<div class="test-result">';
                html += '<h5><i class="fas fa-code"></i> Test 3: Frontend Integration</h5>';
                html += '<p><strong>Status:</strong> <span class="status-ok">Ready!</span></p>';
                html += '<p>Your frontend is configured correctly. Go to the home page and search for flights.</p>';
                html += '<p>The results will appear on the SAME PAGE below the search form.</p>';
                html += '</div>';
                
            } catch (error) {
                html += `<p class="status-error"><i class="fas fa-times-circle"></i> Error: ${error.message}</p>`;
                html += '<p>Make sure your XAMPP Apache server is running and you\'re accessing this from localhost.</p>';
                html += '</div>';
            }
            
            resultsDiv.innerHTML = html;
        }
        
        // Run tests on page load
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>


















